var r,n;!function(r){r[r.URGENT=1]="URGENT",r[r.IDLE=2]="IDLE"}(r||(r={})),function(r){r.NORMAL="NORMAL",r.NODE_UNCAUGHT_ERROR="NODE_UNCAUGHT_ERROR",r.NODE_HTTP_ERROR="NODE_UNCAUGHT_ERROR"}(n||(n={}));var o=require("node-fetch"),t=function(){function n(r){var n=r.logUrl;if(!n)throw new Error("请传递要记录数据的路由~");this.logUrl=n}return n.prototype.sendToAnalytics=function(n,t,e,i){var l=this.logUrl;i&&(l=i),console.log("上报body",t);var c={type:e,content:t};try{n==r.URGENT&&o(l,{body:JSON.stringify(c),method:"POST",headers:{"Content-Type":"application/json"}}).catch(function(){console.log("上报接口发生异常了")})}catch(r){console.log(r)}},n}(),e=function(r){console.log(r)},i={reportClient:new t({logUrl:"log"})};function l(){return function(o,t){try{return Promise.resolve(function(e,l){try{var c=Promise.resolve(t()).then(function(){404===o.status&&i.reportClient.sendToAnalytics(r.URGENT,JSON.stringify(o.request),n.NODE_HTTP_ERROR)})}catch(r){return l(r)}return c&&c.then?c.then(void 0,l):c}(0,function(o){throw console.error(o),i.reportClient.sendToAnalytics(r.URGENT,o.message,n.NODE_HTTP_ERROR),o}))}catch(r){return Promise.reject(r)}}}var c=function(){function o(){}var t=o.prototype;return t.globalUnCaughtError=function(){process.on("uncaughtException",function(o){console.error("There was an uncaught error",o),i.reportClient.sendToAnalytics(r.URGENT,JSON.stringify({message:null==o?void 0:o.message,name:null==o?void 0:o.name,stack:null==o?void 0:o.stack}),n.NODE_UNCAUGHT_ERROR)})},t.run=function(){this.globalUnCaughtError()},o}(),s=require("memeye");module.exports=function(r){void 0===r&&(r={});var n=r.logUrl;if(!n)throw new Error("Web系统系统监控平台，初始化未传递logUrl");var o=new t({logUrl:n});i.reportClient=o,this.reportClient=o,this.handleHttpError=l,i.analyticsTracker=r.analyticsTracker||e,(new c).run(),s()};
//# sourceMappingURL=node-monitor.js.map
